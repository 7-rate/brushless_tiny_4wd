## 定常・カーブ制御

### 基本
カーブに中の角加速度を計算する。  
JCJCのコースは(中心)最小旋回半径R=0.42m、最大旋回半径R=0.66m。  
速度 v m/sのときの角加速度は、
```
gz = 180 * v / (R * pi)
gz = 57.3 * v / R
```
である。


### ロールによる速度限界決め
機体の幅W、重心Hから最小旋回半径における限界速度を計算する。
カーブを曲がれる最高速度は
```
v = sqrt(WgR/2H)
```
である。

機体の幅W=82mm、重心H=15mm、最小旋回半径R=0.42mのとき、
```
v = sqrt((0.082*9.8*0.42)/2*0.015) = 3.35m/s
```
である。

ここで、最高速度時のgzは、
```
gz = 57.3 * v / R = 57.3 * 3.35 / 0.42 = 457deg/s
```
である。

最大旋回半径時の最高速度は、4.2m/sであるから、gzは、
```
gz = 57.3 * 4.2 / 0.66 = 573deg/s
```
である。

### gzに応じた駆動配分
gzから旋回中の左右駆動配分を決める。  
ロールによる速度限界に近づくにつれ、内側のモーターを減速させる。  
0deg/sを100%とし、450deg/sを0%とする。


## 横転防止制御
450deg/sを超えた時は、横転防止制御を行う。  
外側モーターを30%とし、内側モーターを0%とする。
400deg/s以下になったところで通常制御に移行する。

## スロープ制御
上りスロープを検出した場合は両モーターを50ms間0%にし減速する。  
2秒以内に再度スロープを検出した場合は下りスロープであるため、減速処理は行わない。  

### スロープ検出方法
JCJCのスロープ角度は10度。  
4m/sは最低でも出ているはず。  
角度が変化している距離は50cmほどなはず。  
4m/sで50cm進むと0.25s。  
10degが0.25sで変化→40deg/s。
40deg/s以上を50ms継続でスロープと判断する。  